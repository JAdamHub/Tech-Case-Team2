---
layout: default
title: Document Upload
---

<div class="upload-container">
    <h1>Document Upload</h1>
    <p>Drag and drop your markdown (.md) files here or click to select files</p>
    <p class="upload-info">Files will be uploaded to your GitHub repository</p>
    <p class="file-type-info">Only .md files are allowed</p>
    
    <div class="error-message" id="errorMessage" style="display: none;">
        <div class="error-content">
            <span class="error-icon">⚠️</span>
            <div class="error-text">
                <span class="error-title"></span>
                <span class="error-details"></span>
            </div>
            <button class="close-error" onclick="hideError()">×</button>
        </div>
    </div>
    
    <div class="drop-zone" id="dropZone">
        <p>Drop .md files here</p>
        <input type="file" id="fileInput" accept=".md" multiple style="display: none;">
        <button onclick="document.getElementById('fileInput').click()">Select Files</button>
    </div>

    <div class="file-list" id="fileList"></div>
</div>

<style>
    .upload-container {
        max-width: 800px;
        margin: 0 auto;
        background-color: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .error-message {
        background-color: #fff3f3;
        border: 1px solid #ffcdd2;
        border-radius: 4px;
        padding: 1rem;
        margin: 1rem 0;
        animation: fadeIn 0.3s ease-in-out;
        position: relative;
    }
    
    .error-content {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .error-icon {
        font-size: 1.5rem;
    }
    
    .error-text {
        flex: 1;
    }
    
    .error-title {
        display: block;
        color: #d32f2f;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }
    
    .error-details {
        display: block;
        color: #666;
        font-size: 0.9em;
    }

    .close-error {
        background: none;
        border: none;
        color: #d32f2f;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0;
        margin: 0;
        line-height: 1;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .upload-info {
        color: #666;
        font-size: 0.9em;
        margin-bottom: 0.5rem;
        padding: 0.5rem;
        background-color: #f8f9fa;
        border-radius: 4px;
    }
    
    .file-type-info {
        color: #666;
        font-size: 0.9em;
        margin-bottom: 1rem;
        padding: 0.5rem;
        background-color: #e3f2fd;
        border-radius: 4px;
        border-left: 4px solid var(--accent-color);
    }
    
    .drop-zone {
        border: 2px dashed #ccc;
        border-radius: 4px;
        padding: 2rem;
        text-align: center;
        margin: 2rem 0;
        background-color: #fafafa;
        transition: all 0.3s ease;
    }
    
    .drop-zone.dragover {
        background-color: #e3f2fd;
        border-color: var(--accent-color);
    }
    
    .file-list {
        margin-top: 2rem;
    }
    
    .file-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid #eee;
        background-color: white;
        border-radius: 4px;
        margin-bottom: 0.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .file-item:last-child {
        border-bottom: none;
    }
    
    .status {
        color: #666;
        font-size: 0.9em;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
    }
    
    .success {
        color: #4caf50;
    }
    
    .error {
        color: #f44336;
    }

    .file-details {
        display: block;
        font-size: 0.8em;
        color: #666;
        margin-top: 0.25rem;
    }
    
    button {
        background-color: var(--accent-color);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
    }
    
    button:hover {
        background-color: var(--accent-hover);
    }
</style>

<script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const errorMessage = document.getElementById('errorMessage');

    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    // Highlight drop zone when item is dragged over it
    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, unhighlight, false);
    });

    // Handle dropped files
    dropZone.addEventListener('drop', handleDrop, false);
    fileInput.addEventListener('change', handleFiles, false);

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    function highlight(e) {
        dropZone.classList.add('dragover');
    }

    function unhighlight(e) {
        dropZone.classList.remove('dragover');
    }

    function isMarkdownFile(file) {
        return file.name.toLowerCase().endsWith('.md');
    }

    function showError(title, details) {
        errorMessage.style.display = 'block';
        errorMessage.querySelector('.error-title').textContent = title;
        errorMessage.querySelector('.error-details').textContent = details;
    }

    function hideError() {
        errorMessage.style.display = 'none';
    }

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        const validFiles = Array.from(files).filter(isMarkdownFile);
        
        if (validFiles.length === 0) {
            showError('Invalid File Type', 'Please drop only .md files');
            return;
        }
        
        handleFiles({ target: { files: validFiles } });
    }

    function handleFiles(e) {
        const files = [...e.target.files].filter(isMarkdownFile);
        if (files.length === 0) {
            showError('Invalid File Type', 'Please select only .md files');
            return;
        }
        files.forEach(uploadFile);
    }

    async function uploadFile(file) {
        // Create file item in the list
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        fileItem.innerHTML = `
            <span>${file.name}</span>
            <span class="status">Uploading...</span>
        `;
        fileList.appendChild(fileItem);

        try {
            // Read file content
            const content = await file.text();
            
            // Get GitHub token from environment variable or prompt
            const token = await getGitHubToken();
            if (!token) {
                throw new Error('GitHub token is required');
            }

            // Get repository info from URL
            const repoInfo = getRepoInfo();
            if (!repoInfo) {
                throw new Error('Could not determine repository information');
            }

            // Create or update file using GitHub API
            const response = await fetch(`https://api.github.com/repos/${repoInfo.owner}/${repoInfo.repo}/contents/converter_markdown/input_folder_markdown/${file.name}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${token}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: `Add ${file.name}`,
                    content: btoa(unescape(encodeURIComponent(content))),
                    branch: 'main'
                })
            });

            const data = await response.json();

            const status = fileItem.querySelector('.status');
            if (response.ok) {
                status.textContent = 'Uploaded successfully';
                status.classList.add('success');
                if (data.content) {
                    const details = document.createElement('span');
                    details.className = 'file-details';
                    details.textContent = `Saved to: ${data.content.path}`;
                    status.appendChild(details);
                }
                hideError();
            } else {
                const errorMessage = data.message || 'Upload failed';
                const errorDetails = data.documentation_url ? `See ${data.documentation_url} for more information` : 'An unknown error occurred';
                
                status.textContent = errorMessage;
                status.classList.add('error');
                
                const details = document.createElement('span');
                details.className = 'file-details';
                details.textContent = errorDetails;
                status.appendChild(details);
                
                showError(errorMessage, errorDetails);
            }
        } catch (error) {
            const status = fileItem.querySelector('.status');
            status.textContent = 'Upload Error';
            status.classList.add('error');
            const details = document.createElement('span');
            details.className = 'file-details';
            details.textContent = error.message;
            status.appendChild(details);
            showError('Upload Error', error.message);
            console.error('Error:', error);
        }
    }

    function getRepoInfo() {
        // Get repository info from current URL
        const url = window.location.href;
        const match = url.match(/github\.com\/([^\/]+)\/([^\/]+)/);
        if (match) {
            return {
                owner: match[1],
                repo: match[2]
            };
        }
        return null;
    }

    async function getGitHubToken() {
        // Try to get token from localStorage first
        let token = localStorage.getItem('github_token');
        
        if (!token) {
            // Prompt user for token
            token = prompt('Please enter your GitHub Personal Access Token:');
            if (token) {
                localStorage.setItem('github_token', token);
            }
        }
        
        return token;
    }
</script> 